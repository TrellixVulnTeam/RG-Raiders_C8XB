"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r,e,t=require("nanoid");function n(r){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(r)}function o(r,e){return(o=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r})(r,e)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}function u(r,e,t){return(u=i()?Reflect.construct:function(r,e,t){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(r,n));return t&&o(i,t.prototype),i}).apply(null,arguments)}function c(r){var e="function"==typeof Map?new Map:void 0;return(c=function(r){if(null===r||-1===Function.toString.call(r).indexOf("[native code]"))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(r))return e.get(r);e.set(r,t)}function t(){return u(r,arguments,n(this).constructor)}return t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o(t,r)})(r)}(e=exports.ERROR_CODE||(exports.ERROR_CODE={}))[e.PARSE_ERROR=-32700]="PARSE_ERROR",e[e.INVALID_REQUEST=-32600]="INVALID_REQUEST",e[e.METHOD_NOT_FOUND=-32601]="METHOD_NOT_FOUND",e[e.INVALID_PARAMS=-32602]="INVALID_PARAMS",e[e.INTERNAL_ERROR=-32603]="INTERNAL_ERROR";var s=((r={})[exports.ERROR_CODE.PARSE_ERROR]="Parse error",r[exports.ERROR_CODE.INVALID_REQUEST]="Invalid request",r[exports.ERROR_CODE.METHOD_NOT_FOUND]="Method not found",r[exports.ERROR_CODE.INVALID_PARAMS]="Invalid params",r[exports.ERROR_CODE.INTERNAL_ERROR]="Internal error",r);function a(r){return-32e3>=r&&r>=-32099}function l(r){var e;return null!==(e=s[r.toString()])&&void 0!==e?e:a(r)?"Server error":"Application error"}var R=function(r){var e,t;function n(e,t,o){var i;return i=r.call(this)||this,Object.setPrototypeOf(function(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(i),n.prototype),i.code=e,i.data=o,i.message=null!=t?t:l(e),i}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t,n.fromObject=function(r){return new n(r.code,r.message,r.data)},n.prototype.toObject=function(){return{code:this.code,data:this.data,message:this.message}},n}(c(Error));function p(r){var e=s[r];return function(t){return new R(r,e,t)}}var f=p(exports.ERROR_CODE.PARSE_ERROR),E=p(exports.ERROR_CODE.INVALID_REQUEST),O=p(exports.ERROR_CODE.METHOD_NOT_FOUND),d=p(exports.ERROR_CODE.INVALID_PARAMS),_=p(exports.ERROR_CODE.INTERNAL_ERROR),v=function(){function r(r){this.connection=r}var e=r.prototype;return e.createID=function(){return t.nanoid()},e.request=function(r,e){try{return Promise.resolve(this.connection.send({jsonrpc:"2.0",id:this.createID(),method:r,params:e})).then((function(r){if(null==r)throw new Error("Missing response");if(null!=r.error)throw R.fromObject(r.error);return r.result}))}catch(r){return Promise.reject(r)}},r}();function y(r,e){return{jsonrpc:"2.0",id:r,error:{code:e,message:l(e)}}}function h(r,e,t){console.warn("Unhandled handler error",e,t)}function m(r,e){console.warn("Unhandled invalid message",e)}function D(r,e){console.warn("Unhandled notification",e)}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))),exports.ERROR_MESSAGE=s,exports.RPCClient=v,exports.RPCError=R,exports.createErrorResponse=y,exports.createHandler=function(r,e){var t,n,o;void 0===e&&(e={});var i=null!==(t=e.onHandlerError)&&void 0!==t?t:h,u=null!==(n=e.onInvalidMessage)&&void 0!==n?n:m,c=null!==(o=e.onNotification)&&void 0!==o?o:D;return function(e,t){try{var n=t.id;if("2.0"!==t.jsonrpc||null==t.method)return null==n?(u(e,t),Promise.resolve(null)):Promise.resolve(y(n,exports.ERROR_CODE.INVALID_REQUEST));if(null==n)return c(e,t),Promise.resolve(null);var o=r[t.method];return Promise.resolve(null==o?y(n,exports.ERROR_CODE.METHOD_NOT_FOUND):function(r,i){try{var u=function(){var r;function i(r){return{jsonrpc:"2.0",id:n,result:r}}var u=o(e,null!==(r=t.params)&&void 0!==r?r:{});return"function"==typeof u.then?Promise.resolve(u).then(i):i(u)}()}catch(r){return i(r)}return u&&u.then?u.then(void 0,i):u}(0,(function(r){var o;if(r instanceof R)o=r.toObject();else{var u;i(e,t,r);var c=null!==(u=r.code)&&void 0!==u?u:-32e3;o={code:c,message:r.message||l(c)}}return{jsonrpc:"2.0",id:n,error:o}})))}catch(r){return Promise.reject(r)}}},exports.createInternalError=_,exports.createInvalidParams=d,exports.createInvalidRequest=E,exports.createMethodNotFound=O,exports.createParseError=f,exports.getErrorMessage=l,exports.isServerError=a,exports.parseJSON=function(r){try{return JSON.parse(r)}catch(r){throw f()}};
//# sourceMappingURL=rpc-utils.cjs.production.min.js.map
